<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vees | تسجيل حساب جديد</title>
        <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/mazen-alqayser/Air-Ticket-Reservation-dr-anas-project/refs/heads/main/ChatGPT%20Image%20Oct%205%2C%202025%2C%2005_35_52%20PM%20-%20Copy.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLMD/cd8iwQe0V/k-vTNHfK8JpUv2HqE4e1+7Jz5xU2+i/4A6p/bT4/1D3b5a12Xg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');

        body {
            font-family: 'Cairo', sans-serif;
            /* تم إزالة transition على background-image لمنع التضارب مع الـ JS */
        }
        
        /* الخلفية والضبابية (مُعدل لـ iFrame) */
        #video-background {
            position: fixed;
            top: 0; /* تم التعديل */
            left: 0; /* تم التعديل */
            width: 100%; /* تم التعديل */
            height: 100%; /* تم التعديل */
            z-index: -3; 
            object-fit: cover;
            filter: blur(5px) brightness(0.7); 
            transition: opacity 0.5s ease; 
            opacity: 0; /* مخفية مبدئياً حتى يتم تفعيلها من JS */
            display: none; /* مخفية مبدئياً */
        }

        /* طبقة عاتمة فوق الخلفية */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); 
            z-index: -2;
        }

        /* شكل النموذج الزجاجي (Glassmorphism) */
        .professional-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px); 
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 0.8s ease-out;
            transition: all 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* رسالة الخطأ والمدخلات... (دون تغيير) */
        .error-message { color: #ef4444; font-size: 0.875rem; text-align: right; font-weight: 700;}
        .input-style {
            padding: 1rem; border-radius: 0.75rem; border-width: 2px; border-color: #e5e7eb; width: 100%;
            transition: all 0.3s; text-align: right; background-color: rgba(255, 255, 255, 0.7); 
        }
        .input-style:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.25); }


        /* أنماط الصور للخلفية (مُعدّل) */
        .background-item { /* تم تطبيق هذا الكلاس على الفيديو والصور الآن */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            filter: blur(5px) brightness(0.7); 
            opacity: 0; /* مخفية مبدئياً */
            z-index: -4; 
            transition: opacity 0.5s ease; 
            display: none;
        }

        .active-background {
            opacity: 1 !important;
            z-index: -3 !important;
            display: block !important;
        }
        
        /* روابط الصور الخلفية */
        /* ✅ تم استخدام روابط موثوقة للصور */
       #bg-img-1 { background-image: url('https://media.gettyimages.com/id/1541988626/photo/close-up-woman-hands-calculates-on-calculator-for-personal-finance-paysckeck-paper-receipt.jpg?b=1&s=2048x2048&w=0&k=20&c=wM8QPA7euZyeFZvhPE0uJ9bOho5yln5eFGwFcjt0ewY='); }
        /* الصورة 2: تخطيط مالي */
        #bg-img-2 { background-image: url('https://freight.cargo.site/w/1200/i/b843007c50fe29464a76dceaad00e4626349faa0a46e0e3445b6cbb730901ea3/charlie-harris-wwCsbYVxuck-unsplash.jpg'); }
        /* الصورة 3: اجتماعات عمل/تقارير */
        #bg-img-3 { background-image: url('https://images.pexels.com/photos/1181403/pexels-photo-1181403.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'); }
        /* الصورة 4: بيانات وشاشات */
        #bg-img-4 { background-image: url('https://tse1.mm.bing.net/th/id/OIP._5PzKqkqdXTQbsmnW16u6gHaE7?pid=Api&P=0&h=220'); }
        
</style>
</head>
<body class="min-h-screen flex items-center justify-center relative">

<iframe id="video-background" class="background-item active-background"
    src="https://www.youtube.com/embed/l-aV3qt6dKw?autoplay=1&mute=1&loop=1&playlist=l-aV3qt6dKw"
    frameborder="0"
    allow="autoplay; fullscreen"
    allowfullscreen>
</iframe>


<div id="bg-img-1" class="background-item"></div>
<div id="bg-img-2" class="background-item"></div>
<div id="bg-img-3" class="background-item"></div>
<div id="bg-img-4" class="background-item"></div>
    
    <div class="overlay"></div>

    <div class="professional-card p-8 sm:p-10 w-full max-w-3xl mx-4 my-8 z-10">
        
        <div class="mb-4 text-center">
            <i class="fas fa-user-plus text-5xl text-blue-600"></i>
        </div>
        
        <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-3">
            إنشاء حساب <span class="text-blue-600">جديد</span>
        </h1>
        <p class="text-gray-600 text-center mb-8 font-light">
            يرجى ملء النموذج لإنشاء حساب شركتك.
        </p>

        <form id="registration-form" class="space-y-6">
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label for="company-name" class="block text-sm font-bold text-gray-700 mb-2">اسم الشركة</label>
                    <input type="text" id="company-name" placeholder="اسم الشركة" class="input-style" required>
                </div>
                <div>
                    <label for="owner-name" class="block text-sm font-bold text-gray-700 mb-2">اسم المالك</label>
                    <input type="text" id="owner-name" placeholder="اسم المالك" class="input-style" required>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label for="email" class="block text-sm font-bold text-gray-700 mb-2">البريد الإلكتروني</label>
                    <input type="email" id="email" placeholder="البريد الإلكتروني" class="input-style" dir="ltr" required>
                </div>
                <div>
                    <label for="main-phone" class="block text-sm font-bold text-gray-700 mb-2">الرقم الأساسي للتواصل</label>
                    <input type="tel" id="main-phone" placeholder="الرقم الأساسي للتواصل" class="input-style" required>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label for="password" class="block text-sm font-bold text-gray-700 mb-2">كلمة المرور</label>
                    <input type="password" id="password" placeholder="كلمة المرور" class="input-style" required>
                    <p id="password-error" class="error-message hidden mt-1">كلمة المرور لا يمكن أن تكون فارغة.</p>
                </div>
                <div>
                    <label for="confirm-password" class="block text-sm font-bold text-gray-700 mb-2">تأكيد كلمة المرور</label>
                    <input type="password" id="confirm-password" placeholder="تأكيد كلمة المرور" class="input-style" required>
                    <p id="confirm-password-error" class="error-message hidden mt-1">كلمتا المرور غير متطابقتين.</p>
                </div>
            </div>
            
            <div class="grid md:grid-cols-3 gap-4">
                <div>
                    <label for="alt-phone" class="block text-sm font-bold text-gray-700 mb-2">رقم إضافي (اختياري)</label>
                    <input type="tel" id="alt-phone" placeholder="رقم إضافي" class="input-style">
                </div>
                <div>
                    <label for="country" class="block text-sm font-bold text-gray-700 mb-2">البلد</label>
                    <select id="country" class="input-style appearance-none bg-white">
                        <option value="">اختر البلد</option>
                        <option value="saudi-arabia">المملكة العربية السعودية</option>
                        <option value="egypt">مصر</option>
                        <option value="uae">الإمارات العربية المتحدة</option>
                        <option value="other">أخرى</option>
                    </select>
                </div>
                <div>
                    <label for="address" class="block text-sm font-bold text-gray-700 mb-2">العنوان</label>
                    <input type="text" id="address" placeholder="العنوان" class="input-style">
                </div>
            </div>

            <div class="grid md:grid-cols-3 gap-4">
                <div>
                    <label for="industry" class="block text-sm font-bold text-gray-700 mb-2">المجال/النشاط التجاري</label>
                    <select id="industry" class="input-style appearance-none bg-white">
                        <option value="">اختر المجال</option>
                        <option value="retail">تجزئة</option>
                        <option value="restaurants">مطاعم ومقاهي</option>
                        <option value="services">خدمات</option>
                        <option value="wholesale">جملة</option>
                        <option value="other">أخرى</option>
                    </select>
                </div>
                <div>
                    <label for="branches-count" class="block text-sm font-bold text-gray-700 mb-2">عدد الفروع</label>
                    <input type="number" id="branches-count" placeholder="عدد فروع الشركة" min="1" class="input-style">
                </div>
                 <div>
                    <label for="product-type" class="block text-sm font-bold text-gray-700 mb-2">نوع المنتجات/الخدمات</label>
                    <select id="product-type" class="input-style appearance-none bg-white">
                        <option value="">اختر النوع</option>
                        <option value="products">منتجات (تحتاج إدارة مخزون)</option>
                        <option value="services">خدمات (لا تحتاج إدارة مخزون)</option>
                        <option value="both">كلاهما</option>
                    </select>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <label for="user-count" class="block text-sm font-bold text-gray-700 mb-2">عدد المستخدمين المتوقعين</label>
                    <select id="user-count" class="input-style appearance-none bg-white">
                        <option value="1-5">1-5</option>
                        <option value="6-10">6-10</option>
                        <option value="11-20">11-20</option>
                        <option value="20+">أكثر من 20</option>
                    </select>
                </div>
                <div>
                    <label for="how-heard" class="block text-sm font-bold text-gray-700 mb-2">كيف سمعت عن البرنامج؟</label>
                    <select id="how-heard" class="input-style appearance-none bg-white">
                        <option value="">اختر مصدر المعرفة</option>
                        <option value="google">بحث جوجل</option>
                        <option value="social-media">وسائل التواصل الاجتماعي</option>
                        <option value="friend">صديق أو زميل</option>
                        <option value="advertisement">إعلان</option>
                        <option value="other">أخرى</option>
                    </select>
                </div>
            </div>

            <div>
                <label for="purpose" class="block text-sm font-bold text-gray-700 mb-2">الغرض من استخدام البرنامج</label>
                <textarea id="purpose" placeholder="اذكر الغرض من استخدامك للبرنامج (مثال: لإدارة المبيعات، المخزون، الحسابات، إلخ.)" class="input-style resize-none h-24"></textarea>
            </div>
            
            <div class="flex items-center pt-2">
                <input type="checkbox" id="terms" class="h-5 w-5 text-blue-600 focus:ring-blue-500 rounded border-gray-300 ml-2">
                <label for="terms" class="text-base font-medium text-gray-700">أوافق على <span class="text-blue-600 hover:text-blue-800 cursor-pointer transition" onclick="showPopup('الشروط والأحكام', 'بالموافقة، فإنك تقر وتلتزم بسياسات الاستخدام والخصوصية لمنصة المحاسب.')">الشروط والأحكام</span></label>
            </div>
            <p id="terms-error" class="error-message hidden">يجب الموافقة على الشروط والأحكام للمتابعة.</p>

            <p id="form-message" class="text-center font-bold mt-4 hidden"></p>
            <button type="submit" id="submit-btn" class="w-full px-4 py-4 mt-6 bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl transition duration-300 ease-in-out transform scale-100">
                <i class="fas fa-user-plus ml-2"></i> إتمام التسجيل
            </button>
            
           <a href="{{ url_for('login') }}" class="block text-center text-blue-600 hover:text-blue-800 hover:underline mt-4 font-medium transition duration-200">
    هل لديك حساب بالفعل؟ تسجيل الدخول <i class="fas fa-sign-in-alt mr-1"></i>
</a>

            
        </form>
    </div>

    <div id="professional-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden" onclick="closePopup()">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm text-center transform scale-100 transition-all duration-300" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800 mb-3"></h3>
            <p id="modal-content" class="text-gray-600 mb-6"></p>
            <button onclick="closePopup()" class="w-full py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">إغلاق</button>
        </div>
    </div>


<script>
    // ------------------ منطق الجافاسكريبت (مُعدّل) ------------------

    const form = document.getElementById('registration-form');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirm-password');
    const termsCheckbox = document.getElementById('terms');
    const passwordError = document.getElementById('password-error');
    const confirmPasswordError = document.getElementById('confirm-password-error');
    const termsError = document.getElementById('terms-error');
    const formMessage = document.getElementById('form-message');
    const submitBtn = document.getElementById('submit-btn');
    
    // تم تجميع جميع عناصر الخلفية
    const backgrounds = [
        document.getElementById('video-background'), // العنصر رقم 0
        document.getElementById('bg-img-1'),
        document.getElementById('bg-img-2'),
        document.getElementById('bg-img-3'),
        document.getElementById('bg-img-4')  // العنصر رقم 4
    ];
    let currentBgIndex = 0; // البدء بالفيديو (إذا أردت، غيرها إلى 1 للبدء بالصورة الأولى)
    const intervalTime = 7000; // 7 ثواني بين الخلفيات

    // وظيفة إظهار وإخفاء النافذة المنبثقة
    function showPopup(title, content) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-content').textContent = content;
        document.getElementById('professional-modal').classList.remove('hidden');
    }

    function closePopup() {
        document.getElementById('professional-modal').classList.add('hidden');
    }
    
    // منطق تبديل الخلفية (مُعدّل ليعمل مع نظام الكلاسات)
    function switchBackground() {
        // إخفاء جميع الخلفيات
        backgrounds.forEach(bg => bg.classList.remove('active-background'));

        // الانتقال إلى الخلفية التالية
        currentBgIndex = (currentBgIndex + 1) % backgrounds.length;
        
        // إظهار الخلفية الجديدة
        backgrounds[currentBgIndex].classList.add('active-background');

        // ملاحظة: الفيديو المضمن (iframe) لا يحتاج لـ play/pause في JS، فمعلمات loop و autoplay تقوم باللازم.
    }

    // تعيين الخلفية الأولى وبدء التبديل التلقائي
    if (backgrounds.length > 0) {
        // البدء بالعنصر الأول (الفيديو أو الصورة الأولى)
        backgrounds[currentBgIndex].classList.add('active-background');
        // بدء التبديل
        setInterval(switchBackground, intervalTime);
    }
    
   // *************** منطق إرسال النموذج الحقيقي (التعديل المطلوب) ***************

form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // إخفاء جميع رسائل الخطأ في البداية
    passwordError.classList.add('hidden');
    confirmPasswordError.classList.add('hidden');
    termsError.classList.add('hidden');
    formMessage.classList.add('hidden');
    formMessage.classList.remove('text-red-600', 'text-green-600', 'text-yellow-600'); // أضفنا الأصفر للحالات الخاصة

    let isValid = true;

    // ... (كود التحقق من الحقول الأخرى كما هو) ...

    // التحقق من طول كلمة المرور (افتراضياً 6 أحرف كحد أدنى)
    if (passwordInput.value.trim().length < 6) { 
        passwordError.textContent = 'كلمة المرور يجب أن لا تقل عن 6 أحرف/أرقام.';
        passwordError.classList.remove('hidden');
        isValid = false;
    }

    // التحقق من تطابق كلمات المرور
    if (passwordInput.value !== confirmPasswordInput.value) {
        confirmPasswordError.textContent = 'كلمتا المرور غير متطابقتان.';
        confirmPasswordError.classList.remove('hidden');
        isValid = false;
    }

    // التحقق من الموافقة على الشروط
    if (!termsCheckbox.checked) {
        termsError.classList.remove('hidden');
        isValid = false;
    }

    if (!isValid) return;

    // إظهار حالة التحميل
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i> جاري التسجيل...';
    submitBtn.disabled = true;
    
    // جمع البيانات من النموذج
    const registrationData = {
        company_name: document.getElementById('company-name').value,
        owner_name: document.getElementById('owner-name').value,
        email: document.getElementById('email').value,
        password: passwordInput.value,
        main_phone: document.getElementById('main-phone').value,
        additional_phone: document.getElementById('alt-phone').value,
        country: document.getElementById('country').value,
        address: document.getElementById('address').value,
        industry: document.getElementById('industry').value,
        // تأكد من تحويل القيم الرقمية إلى أرقام إذا لزم الأمر في الـ backend، أو أرسلها كنصوص كما هي
        branches_count: document.getElementById('branches-count').value || null, 
        product_type: document.getElementById('product-type').value,
        expected_users: document.getElementById('user-count').value || null,
        purpose: document.getElementById('purpose').value,
        how_heard: document.getElementById('how-heard').value,
    };
    
    // ***************** إرسال البيانات الحقيقي باستخدام fetch *****************
    try {
        const response = await fetch('/api/register', { //  المسار الصحيح
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(registrationData), // إرسال البيانات كـ JSON
        });
        
        const result = await response.json(); // قراءة الرد من الخادم (رسالة النجاح أو الخطأ)

        if (response.ok) { // حالة النجاح (عادةً 201)
            // رسالة التسجيل الناجح
            formMessage.textContent = ' ' + result.message + ' سيتم التواصل معك فور مراجعة الطلب. ستتم إعادة التوجيه...';
            formMessage.classList.add('text-green-600');
            
            // يمكن إضافة إعادة توجيه بعد بضع ثوانٍ
            setTimeout(() => {
                // يمكنك توجيهه إلى صفحة شكر أو صفحة تسجيل الدخول
                // window.location.href = '/login'; 
            }, 3000);

        } else { // حالات الخطأ (400, 409, 500)
            const errorMessage = result.error || 'حدث خطأ غير معروف أثناء التسجيل.';
            
            if (response.status === 409) { // تكرار البريد الإلكتروني
                formMessage.textContent = ' ' + errorMessage;
                formMessage.classList.add('text-yellow-600'); // استخدام لون مختلف لتنبيه محدد
            } else if (response.status === 400) { // بيانات غير مكتملة
                formMessage.textContent = ' خطأ في البيانات: ' + errorMessage;
                formMessage.classList.add('text-red-600');
            } else { // خطأ خادم (500) أو غيره
                formMessage.textContent = ' فشل التسجيل: ' + errorMessage;
                formMessage.classList.add('text-red-600');
            }
        }

    } catch (error) {
        // خطأ شبكة (فشل الاتصال بالخادم)
        formMessage.textContent = ' فشل الاتصال بالخادم. يرجى التحقق من اتصالك بالإنترنت.';
        formMessage.classList.add('text-red-600');
    } finally {
        formMessage.classList.remove('hidden');
        submitBtn.innerHTML = '<i class="fas fa-user-plus ml-2"></i> إتمام التسجيل';
        submitBtn.disabled = false;
    }
});

</script>
</body>
</html>